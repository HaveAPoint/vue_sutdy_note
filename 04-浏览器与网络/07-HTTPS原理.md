# HTTPS 原理简述

## 目标

- **机密性**：对称加密保护内容不被窃听。
- **完整性**：消息摘要 + MAC/AEAD 防篡改。
- **身份认证**：数字证书验证服务端身份（双向 HTTPS 还可验证客户端）。

## TLS 握手核心流程（TLS 1.2/1.3 简化版）

1. **客户端发起**：`ClientHello`，带上 TLS 版本、支持的密码套件、随机数。
2. **服务端响应**：`ServerHello`，选择密码套件，发送随机数和**服务端证书**（包含公钥）。
3. **验证证书**：客户端校验证书链（颁发者、有效期、域名匹配、是否吊销）。
4. **生成对称密钥**：
   - RSA 握手：客户端用服务端公钥加密预主密钥并发送。
   - ECDHE/DHE：双方通过 Diffie-Hellman 交换，协商出会话密钥（支持前向安全）。
5. **握手结束**：双方用协商出的对称密钥切换到加密通道，后续 HTTP 报文走对称加密。

TLS 1.3 简化了握手，并强制使用（EC）DHE，默认前向安全，支持 0-RTT（有重放风险）。

## 证书链与信任

- 服务器证书由 CA 签发，浏览器内置根证书列表。
- 验证流程：服务端证书 → 中间 CA → 根 CA，逐级验证签名直到受信任的根。
- 证书包含公钥、域名（CN/SAN）、有效期、公钥算法等信息。

## 常见问题

- 浏览器警告：证书过期、域名不匹配、自签证书/不受信任 CA。
- 中间人攻击：若信任链被破坏或用户忽略警告，攻击者可伪造证书。
- HSTS：强制使用 HTTPS，防止降级到 HTTP。
