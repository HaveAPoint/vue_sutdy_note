# 从输入 URL 到页面渲染 发生了什么？

这是一道涵盖网络、浏览器、服务器的综合面试题。

## 1. 简要流程

1. **DNS 解析**：把域名变 IP。
2. **TCP 连接**：三次握手建立连接。
3. **发送 HTTP 请求**。
4. **服务器处理请求**并返回 HTTP 报文。
5. **浏览器解析渲染页面**。
6. **连接结束**。

---

## 2. 详细步骤

### 第一步：DNS 解析 (Domain Name System)
浏览器不知道 `google.com` 在哪，它只认识 IP 地址。
**查找循序**：
1. 浏览器缓存
2. 系统 hosts 文件
3. 路由器缓存
4. ISP (运营商) DNS 缓存
5. 根域名服务器 (递归查询)

### 第二步：TCP 连接 (三次握手)
见《03-TCP三次握手四次挥手.md》。

### 第三步：发送 HTTP 请求
浏览器构建请求报文（请求行、请求头、请求体），发送给服务器。

### 第四步：服务器处理
服务器（Nginx/Apache/Tomcat）收到请求，处理逻辑（查数据库等），返回响应报文（状态码 200，HTML 字符串）。

### 第五步：浏览器渲染 (关键)
浏览器拿到 HTML 后：
1. **解析 HTML** -> 生成 **DOM 树**。
2. **解析 CSS** -> 生成 **CSSOM 树**（CSS Object Model）。
3. **合并** -> DOM + CSSOM = **Render Tree (渲染树)**。
   - 注意：`display: none` 的节点不会在渲染树中。
4. **回流 (Reflow / Layout)**：计算元素在设备视口中的具体大小和位置。
5. **重绘 (Repaint)**：填充像素（颜色、背景、阴影等）。

### 第六步：执行 JavaScript
JS 可能会操作 DOM 或 CSS，因此 JS 引擎和渲染引擎是互斥的。JS 执行会阻塞渲染。
- `async`：下载完就立即执行（乱序）。
- `defer`：下载完，等文档解析完才执行（顺序）。

---

## 3. 经典优化考点

- **减少 DNS 查询**：DNS 预解析 `<link rel="dns-prefetch">`。
- **减少 HTTP 请求**：合并 CSS/JS，雪碧图，Base64。
- **使用 CDN**：就近获取资源。
- **CSS 放头部，JS 放底部**：
  - CSS 放头：避免页面闪烁（先无样式后有样式）。
  - JS 放底：避免阻塞 HTML 解析。
