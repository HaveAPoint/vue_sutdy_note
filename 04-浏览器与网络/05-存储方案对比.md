# 浏览器存储方案对比

## 1. 三大金刚对比

| 特性 | Cookie | LocalStorage | SessionStorage |
|------|--------|--------------|----------------|
| **容量** | 小 (4KB) | 大 (5MB+) | 大 (5MB+) |
| **有效期** | 依据 Expires，默认会话级 | **永久有效** (除非手动删) | **会话级** (关标签页即失效) |
| **网络请求** | **每次都会带到 Header 中** | 不参与服务器通信 | 不参与服务器通信 |
| **作用域** | 同域名 | 同源 (协议+域名+端口) | 同源且同窗口 (标签页隔离) |
| **API** | 难用 (`document.cookie`) | 好用 (`getItem/setItem`) | 好用 |

---

## 2. 详细解读

### Cookie
- **初衷**：为了解决 HTTP 无状态问题，用于**身份认证**（Session ID）。
- **缺点**：每次请求都带，浪费带宽；容量太小。
- **属性**：
  - `HttpOnly`: 禁止 JS 访问 (防止 XSS 攻击)。
  - `Secure`: 只能通过 HTTPS 传输。
  - `SameSite`: 防止 CSRF 攻击。

### LocalStorage
- **用途**：持久化缓存（主题设置、用户偏好、简单的草稿）。
- **注意**：只能存字符串！对象需要 `JSON.stringify`。

### SessionStorage
- **用途**：一次性临时数据（表单多步填写数据）。
- **注意**：同一个页面打开两个标签页，SessionStorage **不共享**。

---

## 3. 其他存储

### IndexedDB
- 浏览器端的非关系型数据库。
- **容量**：巨大 (几百 MB 甚至更多)。
- **操作**：异步，支持事务、索引。
- **用途**：离线应用、复杂的大量数据缓存。

---

## 4. 面试题

### Token 存哪里好？Cookie 还是 LocalStorage？

没有绝对标准，各有优劣。

1. **存 LocalStorage**
   - 优点：方便控制，不会自动发给服务器（避免 CSRF）。
   - 缺点：容易被 XSS 攻击读取（JS 可以直接读）。

2. **存 Cookie (HttpOnly)**
   - 优点：JS 读不到（防 XSS），自动发送。
   - 缺点：容易遭受 CSRF 攻击（需配合 SameSite 或 CSRF Token 防御）。

**主流方案**：为了方便前端控制 Header（Bearer Token），现在很多 SPA 选择存 LocalStorage。但安全性要求极高的系统倾向于 HttpOnly Cookie。
